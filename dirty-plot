#!/usr/local/bin/python3

import sys
import datetime
import string
import time
import dateutil.parser
import logging

logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)

def try_pandas(s,fn):
    want_pandas = True
    if want_pandas:
        try:
            import pandas as pd
        except:
            return

        df=pd.DataFrame(s)
        df.to_json(fn)
        logger.debug("pandas saved to '%s'",fn)

def main():
    section="meminfo"
    sets={section:{}}

    for l in sys.stdin:
        l=l.strip()
        (ts,key,val)=str.split(l,"\t",2)
        t=dateutil.parser.parse(ts)
        epoch=time.mktime(t.timetuple())
        formatted="%s %s" % (epoch,val)

        # Backward compatible output
        if key=="Dirty":
            print (formatted)

        if key not in sets[section]:
            sets[section][key] = []
        sets[section][key].append(formatted)

    try_pandas(sets,'%s.json' % section)

if __name__ == '__main__':
    main()
